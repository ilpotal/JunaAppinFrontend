# AngJunahaku

## Yleisesittely

JunaApp -sovelluksella sovelluksen käyttäjä voi hakea oman sijaintinsa ja lähimmän rautatieaseman sijannin, sekä lähimmältä rautatieasemalta lähtevät junavuorot. Sovellus sijoittaa käyttäjän, sekä lähimmän henkilöliikennettä harjoittavan rautatieaseman sijainnin kartalle. Kun käyttäjä on hakenut sijaintinsa ja frontend on saanut serveriltä lähimmän rautatieaseman, käyttäjä näkee tiedot sovelluksen etusivulla. Sen lisäksi valikkoon tulee uusi valinta "Juna-aikataulut", jonka valitsemalla pääsee etsimään lähimmältä rautatieasemalta käyttäjän valitsemalle kohdeasemalle seuraavan 24 tunnin aikana lähtevät junat. Palvelu näyttää tai serveri palauttaa oletuksena vain 10 ensimmäistä lähtevää junavuoroa. Tämä asetus on serverillä. Mikäli päätelaitteen näyttö sallii leveämmän sovellusikkunan, saa lähtevistä junavuoroista halutessaan myös niiden väliasemat matkalla kohdeasemalle. Väliasemien näkyminen edellyttää että frontendin tulostamaan taulukkoon tulee Väliasemat -sarake, jossa on Väliasemat -nappi. Nappia klikkaamalla junavuorotaulukon alle tulostuu lista väliasemista mikäli niitä on. Väliasema-sarakkeen näkyminen edellyttää että päätelaite näyttö on riittävän leveä. Myös Väliasema-tulosteessa on rajoitettu sarakkeiden näkymistä, mikäli päätelaitteen näyttö on kapea.

Sijainnin, lähimmän rautatieaseman ja lähtevien junavuorojen, tai niiden väliasemien näkeminen ei edellytä kirjautumista. Kirjautumalla palveluun,saa valikkoon lisäksi valinnan "Tietokanta", josta näkyy kaikki palvelun käyttäjille palauttamat junavuorot. Jos käyttäjän rooli on isadmin = true, tulee Tietokanta -tauluun myös sarake, jossa on Poista -nappi kullakin rivillä. Kun nappia painaa, saa kyseisen rivin poistettua tietokannasta.

Kun käyttäjä on kirjautunut palveluun sisään, valikkoon tulee lisäksi Käyttäjätiedot -linkki, jonka kautta käyttäjä näkee oman käyttäjätunnuksensa ja päivämäärän, jolloin hän rekisteröityi palveluun. Lisäksi Käyttäjätiedot-sivulla näkyy päivämäärä, jolloin käyttäjä edellisen kerran kirjautui palveluun. Käyttäjä näkee myös kuinka monta kertaa hän on kirjautunut palveluun sisään. Käyttäjätiedot -sivulla on lisäksi nappi, jolla pääsee poistamaan käyttäjän tiedot palvelun tietokannasta.

Sovelluksen valikossa on myös Ohje-valinta, josta käyttäjä näkee lyhyen ohjeistuksen palvelun käytöstä. Luonnollisesti sovelluksessa on rekisteröinti-, sisäänkirjautumis-, sekä uloskirjautumisvalinta.

Sovelluksessa voi rekisteröityä vain ei-admin -tasolla, admin-tason tunnukset, jos niitä tarvitaan lisää, tehdään esimerkiksi Postmanilla. Admin-tason tunnushan ei anna muuta lisäarvoa kuin, että sillä kirjautumalla pääsee poistamaan tietokannasta rivin kerrallaan. Lähinnä halusin nähdä, että miten eri käyttäjätasolle saa erilaistetun näkymän ja toiminnallisuuden.

Frontend-sovellus on tehty JavaScripitillä Angularilla ja serverisovellus Node.js -ympäristössä hyvödyntäen Expressiä. Frontendin ulkoasua on maustettu kevyesti Bootstrapilla. Bootstrapin osalta projektin aikana havaitsin että versio 5.1.0 ei toiminut siten kuten olisi pitänyt. 5.1.0 -versiota käytettäessä ylävalikko ei laajentunut alaspäin ollenkaan. Kun päivitin sen alempaan 4.6.0 -versioon navi toimi kuten pitikin.

## Rajapinnat ja palveluita

Front-end -sovelluksesta on API-rajapinnat serverille. Serveriltä on kyselyjä VR:n tarjoamaan Fintraffic / Digtraffic -avoimen datan palveluun. Lisäksi serverin taustamma on mongo-tietokanta, johon palvelun käyttäjät ja palvelun käyttäjille palauttamat junavuorot tallennetaan. Frontendiin näkyviin saatavassa Tietokanta-näkymässä ei ole käyttäjiin liittyvää tietoa. Kaikki käyttäjiin liittyvä tieto on User-taulussa: käyttäjätunnus, salasana kryptattuna, palveluun rekisteröitymispäivä, viimeisin kirjautumispäivä, sekä kirjautumiskertojen lukumäärä. Käyttäjä voi poistaa tietonsa User-taulusta sovelluksesta.

Kartta- ja sijaintitiedoissa hyödynnetään OpenStreetMapia, sekä Leafletiä.

Ulkoasukirjastona käytetään Bootstrapin versiota 4.6.0

Olen pyrkinyt kommentoimaan koodin sekaan, jos koodissa on käytetty muuta kuin omaa koodiani. Vähäinen määrä lainattua koodia on kurssin tehtävistä hyödynnettyä koodia, omaan tarpeeseen soveltuvin osin muokattua.

Kehityksessä käytin Gittiä, tosin tajusin, että sitä pitää käyttää, vasta loppumetreillä, mutta aika monta committia olen kuitenkin ehtinyt jo tehdä sekä serveripuolella, että frontend-puolella. Suurin haaste Gitin osalta tuli kuitenkin siinä vaiheessa kun koodia olin siirtämässä GitHubiin, perinteinen git push ... ei toiminut, vaan jouduin ottamaan käyttöön GitHub Desktopin, mikä ei olisi ollut ongelma, jos se olisi ollut alusta alkaen käytössäni. Olisi varmasti ollut mahdollista pelastaa mukaan myös aiemman commitit Github Desktopilla siirtämään koodiin, mutta se jäi tekemättä. Joten nyt GitHubissa ei ole kovin montaa committia, mutta tarvittaessa minulta löytyy koodin aikaisempia kehitysversioita koneeltani.

Palvelun MongoDB-tietokanta on MongoDB Atlas-palvelussa ja serveri on Herokussa. Frontend-sovellus on Firebasessa osoitteessa: https://junaappi.web.app

## Huomioita kehityksestä

Harjoitustyö oli mielenkiintoinen ja siitä sai juuri niin haastavan kuin halusi. Monessa kohtaa meni hetkeksi sormi suuhun, mutta ratkaisu löytyi aina netistä googlettamalla ja Youtube -videoita katsomalla. Youtubesta löytyy lukematon määrä hyödyllisiä "kursseja" tai opasvideoita, osa niistä on hyvinkin valaisevia. Web-kehittäjän kurssi antoi lopputyölle erittäin hyvä puitteet, oli erittäin hyödyllistä että kurssilla käytiin koodeja läpi ja niitä tehtiin opettajan opastuksella. Haasteeksi on meinannut nousta se, että koodaamisesta ei meinaa tulla loppua. Sovellukseen keksii koko ajan lisää ominaisuuksia, joita siihen haluaisi tehdä. Toisaalta kuitenkin totesin, että lopputyö pitää saada palautettua - koodin lisäämistä voi jatkaa myöhemmin.

Ehdottamasti sovelluksen pitäisi tukea paremmin eri päätelaitteita, eli olla responsiivisempi. Lisäksi, jos kirjautuu adminina, ja poistaa tietokannasta rivejä, taulun päivittyminen kestää kauan. Eli joko taulun rivimääriä pitäisi rajoittaa tai sitten tehdä valmiiksi valittavaksi hakukriteereitä, jolloin tulostaulu olisi pienempi. Onneksi normaali käyttäjä ei pääse poistamaan tietokannan rivejä, mutta on todennäköistä, että otan tietokannan kokonaan pois käytöstä, koska se ei ole palvelun kannalta oleellinen.

## Havaintoja tuotannosta

Päivämäärän formaatti vaihtui kun deployasin serverin herokuun. Samoin junareitti-tauluissa näkyvä kellonaika formaatti vaihtui AM/PM -tyyliseksi. Ja käyttäjänkin rekisteröitymispäivän formaatti muuttui formaattiin kk/pp/vvvv, kun se lokaalisti serveriä ajettuna oli pp.kk.vvvv. Sinällään tiedon oikeellisuus säilyy, mutta tuon tutkin myöhemmin.

Sovellus istui yllättävän hyvin ainakin Samsung Galaxy A40:n näytölle (5,9 tuumaa), sekä One Plus 8 Pro:n näytölle (6,55 tuumaa. Kartta saisi olla vähän leveämpi kummassakin tapauksessa. Samsung Galaxt Tab A:ssa (näyttö 10,1 tuumaa) kartta saisi olla merkittävästi leveämpi. Nyt kartta on staattisen kokoinen, tosin koko vaihtuuu css:llä 5 kertaa kun näyttötila vaihtuu. Kartasta olisi hyvä tehdä dynaamisen kokoinen, jotta se hyödyntäisi koko alan. Nyt myös pienimmällä testaamallani näytöllä (5,9) reittitietojen lähde -teksti jää kartan taakse, joten tuokin pitää tutkia. Myös kartan alkuzoomauksen oletuksen pitäisi riippua käyttäjän ja rautatieaseman etäisyydestä, nyt karttanäkymä on alussa turhan laaja.

Laajemmassa kenttätestissä havaitsin, että nähtävästi Google tarjoaa aika harvakseltaan sijantitietoa getCurrentPosition() -metodilla. Yritin kaivella olisiko koodissa jotakin outoa, mutta kun tein testejä kolmella eri Android-laitteella, niin havaitsin että haaste taitaakin olla sijantitiedon saannissa. Sijainnit päivittyivät eri laitteissa eri aikaan ja eri aikavälein. Mietin jo, että otan koko Päivitä sijaintisi -napin pois, mutta teen sen jatkokehityksenä, jos en keksi miten sijainnin saa useammin kuin sen nyt näyttää saavan. Tietokoneessa hyödynsin kehittäjän työkaluissa olevaa sensori-toiminnetta ja sitä säätelemällä sovellus antoi aina uuden sijainnin kun painoi Päivitä sijaintisi -nappia. Tein kuitenkin korjaus-deploymentin ja lisäsin getCurrentPosition() -metodiin optioita, eli enableHighAccurancy: true ja maximumAge: 0. Niistä ei ainakaan haittaa toiminnan suhteen ole. Lisäsin myös sijannin aikaleiman, joka kertoo myös sen, että vaikka Päivitä sijainti -nappia painaa, laite ei anna aina tuoretta sijaintia. Sijainnin päivitys toimii kuitenkin hyvin kun edellisestä päivityksestä on vierähtänyt tovi.
